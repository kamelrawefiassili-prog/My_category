
    async function deleteCategory(index) {
        if (!confirm("هل تريد بالتأكيد حذف هذا الكاتيغوري؟")) return;
        categories.splice(index, 1);
        await commitChanges();
    }

    async function commitChanges() {
        showLoading(true);
        // تنسيق الكود ليصبح مطابقاً لملفك تماماً
        const formattedArray = categories.map(cat => {
            return `{\n    id: "${cat.id}",\n\n    label: "${cat.label}",\n\n    icon: "${cat.icon}",\n\n    keys: ${JSON.stringify(cat.keys, null, 8).replace(/]$/, '    ]')},\n\n    singleAccount: ${cat.singleAccount},\n\n    description: "${cat.description}",\n\n    subGroups: ${JSON.stringify(cat.subGroups, null, 8).replace(/]$/, '    ]')}\n}`;
        }).join(',\n                \n                ');

        const finalFileContent = `const FIXED_CATEGORIES = [\n                ${formattedArray}\n];`;

        try {
            const url = `https://api.github.com/repos/${GH_CONFIG.owner}/${GH_CONFIG.repo}/contents/${GH_CONFIG.path}`;
            const res = await fetch(url, {
                method: 'PUT',
                headers: { 
                    'Authorization': `token ${GH_CONFIG.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: "Update categories via dashboard",
                    content: toB64(finalFileContent),
                    sha: fileSHA
                })
            });

            if (res.ok) {
                const data = await res.json();
                fileSHA = data.content.sha;
                alert("✅ تم التحديث بنجاح!");
                closeModal();
                renderUI();
            } else {
                throw new Error("فشل التحديث");
            }
        } catch (e) {
            alert("خطأ: " + e.message);
        }
        showLoading(false);
    }

    function closeModal() { document.getElementById('catModal').style.display = 'none'; }
    function showLoading(show) { document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none'; }

    // تشغيل التطبيق
    init();
</script>

</body>
</html>
